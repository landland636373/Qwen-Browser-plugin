<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’ä»¶æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        .section h2 {
            color: #495057;
            margin-bottom: 15px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success { background-color: #d4edda; color: #155724; }
        .status.error { background-color: #f8d7da; color: #721c24; }
        .status.warning { background-color: #fff3cd; color: #856404; }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background-color: #0056b3; }
        .btn:disabled { background-color: #6c757d; cursor: not-allowed; }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .test-image {
            max-width: 200px;
            border: 2px dashed #007bff;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Gua Step3åæ¨+é­”æ­ç”Ÿå›¾ æ’ä»¶æµ‹è¯•</h1>
        
        <!-- æ’ä»¶çŠ¶æ€æ£€æŸ¥ -->
        <div class="section">
            <h2>1. æ’ä»¶çŠ¶æ€æ£€æŸ¥</h2>
            <div id="extensionStatus" class="status warning">æ£€æŸ¥ä¸­...</div>
            <button class="btn" onclick="checkExtension()">é‡æ–°æ£€æŸ¥æ’ä»¶</button>
        </div>
        
        <!-- åç«¯æœåŠ¡æ£€æŸ¥ -->
        <div class="section">
            <h2>2. åç«¯æœåŠ¡æ£€æŸ¥</h2>
            <div id="serverStatus" class="status warning">æ£€æŸ¥ä¸­...</div>
            <button class="btn" onclick="checkServer()">æ£€æŸ¥æœåŠ¡å™¨è¿æ¥</button>
            <div style="margin-top: 10px;">
                <small>åç«¯æœåŠ¡åœ°å€: <code>http://localhost:5000</code></small>
            </div>
        </div>
        
        <!-- æµ‹è¯•å›¾ç‰‡ -->
        <div class="section">
            <h2>3. æµ‹è¯•å›¾ç‰‡</h2>
            <p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•å›¾ç‰‡æ¥éªŒè¯æ’ä»¶åŠŸèƒ½ï¼š</p>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div>
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZTllY2VmIi8+PHBvbHlnb24gcG9pbnRzPSI1MCwxMjAgODAsMTIwIDEwMCw4MCA2MCw0MCA0MCw2MCAyMCw4MCIgZmlsbD0iIzZjNzU3ZCIvPjxjaXJjbGUgY3g9IjE2MCIgY3k9IjMwIiByPSIxNSIgZmlsbD0iI2ZmYzEwNyIvPjx0ZXh0IHg9IjEwMCIgeT0iMTQwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM0OTUwNTciPuWxseWzsOmjjuaZrzwvdGV4dD48L3N2Zz4=" 
                         class="test-image" alt="å±±å³°é£æ™¯">
                    <p><small>æµ‹è¯•å›¾ç‰‡1: å±±å³°é£æ™¯</small></p>
                </div>
                <div>
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+PGNpcmNsZSBjeD0iMTAwIiBjeT0iNzUiIHI9IjQwIiBmaWxsPSIjMDA3YmZmIiBvcGFjaXR5PSIwLjciLz48Y2lyY2xlIGN4PSI2MCIgY3k9IjYwIiByPSIyNSIgZmlsbD0iIzI4YTc0NSIgb3BhY2l0eT0iMC44Ii8+PGNpcmNsZSBjeD0iMTQwIiBjeT0iNTAiIHI9IjIwIiBmaWxsPSIjZGMzNTQ1IiBvcGFjaXR5PSIwLjciLz48dGV4dCB4PSIxMDAiIHk9IjE0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNDk1MDU3Ij7lnZDkvZPlm77moYg8L3RleHQ+PC9zdmc+" 
                         class="test-image" alt="æŠ½è±¡å›¾å½¢">
                    <p><small>æµ‹è¯•å›¾ç‰‡2: æŠ½è±¡å›¾å½¢</small></p>
                </div>
            </div>
            <p><small>ğŸ’¡ æç¤º: å³é”®ä¿å­˜å›¾ç‰‡ï¼Œç„¶ååœ¨æ’ä»¶ä¸­ä¸Šä¼ æµ‹è¯•</small></p>
        </div>
        
        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="section">
            <h2>4. ä½¿ç”¨è¯´æ˜</h2>
            <ol>
                <li><strong>å®‰è£…æ’ä»¶</strong>: åœ¨Chromeä¸­åŠ è½½ <code>extension</code> æ–‡ä»¶å¤¹</li>
                <li><strong>å¯åŠ¨åç«¯</strong>: è¿è¡Œ <code>python web_app.py</code></li>
                <li><strong>é…ç½®è®¾ç½®</strong>: åœ¨æ’ä»¶ä¸­è®¾ç½®OpenAI API Keyå’ŒModelScope Cookie</li>
                <li><strong>æµ‹è¯•åŠŸèƒ½</strong>: ä¸Šä¼ å›¾ç‰‡å¹¶ç‚¹å‡»"åæ¨å¹¶ç”Ÿæˆ"</li>
            </ol>
        </div>
        
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="section">
            <h2>5. è°ƒè¯•ä¿¡æ¯</h2>
            <button class="btn" onclick="showDebugInfo()">æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
            <button class="btn" onclick="clearDebugInfo()">æ¸…é™¤ä¿¡æ¯</button>
            <pre id="debugInfo">ç‚¹å‡»"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯...</pre>
        </div>
    </div>

    <script>
        // æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…
        function checkExtension() {
            const statusDiv = document.getElementById('extensionStatus');
            
            // æ£€æŸ¥æ˜¯å¦åœ¨Chromeæ‰©å±•ç¯å¢ƒä¸­
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… æ’ä»¶ç¯å¢ƒæ£€æµ‹æˆåŠŸ - æ‰©å±•ID: ' + chrome.runtime.id;
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ æœªæ£€æµ‹åˆ°Chromeæ‰©å±•ç¯å¢ƒï¼Œè¯·ç¡®ä¿å·²æ­£ç¡®å®‰è£…æ’ä»¶';
            }
        }
        
        // æ£€æŸ¥åç«¯æœåŠ¡
        async function checkServer() {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.className = 'status warning';
            statusDiv.textContent = 'ğŸ”„ æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨è¿æ¥...';
            
            try {
                const response = await fetch('http://localhost:5000/health', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ… åç«¯æœåŠ¡è¿æ¥æ­£å¸¸ - ' + (data.message || 'æœåŠ¡è¿è¡Œä¸­');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âŒ åç«¯æœåŠ¡å“åº”å¼‚å¸¸ - HTTP ' + response.status;
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ - ' + error.message;
            }
        }
        
        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        function showDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const info = {
                timestamp: new Date().toLocaleString(),
                userAgent: navigator.userAgent,
                location: window.location.href,
                chromeExtension: typeof chrome !== 'undefined' && chrome.runtime ? {
                    id: chrome.runtime.id || 'N/A',
                    version: chrome.runtime.getManifest ? chrome.runtime.getManifest().version : 'N/A'
                } : 'Not available',
                localStorage: {
                    available: typeof localStorage !== 'undefined',
                    items: localStorage ? Object.keys(localStorage).length : 0
                },
                permissions: {
                    storage: typeof chrome !== 'undefined' && chrome.storage ? 'Available' : 'Not available',
                    activeTab: 'Unknown'
                }
            };
            
            debugInfo.textContent = JSON.stringify(info, null, 2);
        }
        
        // æ¸…é™¤è°ƒè¯•ä¿¡æ¯
        function clearDebugInfo() {
            document.getElementById('debugInfo').textContent = 'ç‚¹å‡»"æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯...';
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            checkExtension();
            checkServer();
        });
        
        // å®šæœŸæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        setInterval(checkServer, 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    </script>
</body>
</html>